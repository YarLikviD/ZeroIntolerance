<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ZeroIntolerance (by Робототехнюки)</title>
</head>

<body>

	<canvas id='main_field'>Обновите браузер</canvas>
	<script>
		var ws = new WebSocket("ws://localhost:8080/ws");
		ws.onopen = function (event) {
			ws.send(JSON.stringify(Player))
			draw(players);
		}
		ws.onmessage = function (event) {
			console.log(event);
			players = JSON.parse(event.data);
			draw(players);
		};
	</script>
	<script>
		let example = document.getElementById("main_field"),
			ctx = example.getContext('2d');

		example.height = 1000;
		example.width = 1000;

		var players = []
		var Player = {
			x: Math.round(Math.random() * 100),
			y: Math.round(Math.random() * 100)
		}

		function draw(players) {
			ctx.clearRect(0, 0, 640, 480);
			ctx.font = "15pt Arial";

			for (pl of players) {
				ctx.fillText("0", pl.x, pl.y);
			}

			// window.requestAnimationFrame(draw(players));
		}

		document.addEventListener('keypress', function (e) {
			if (e.key === 'w') { Player.y-- }
			else if (e.key === 'd') { Player.x++ }
			else if (e.key === 's') { Player.y++ }
			else if (e.key === 'a') { Player.x-- }

			ws.send(JSON.stringify(Player))
			console.log('Success onkeypress');
		});

	</script>
</body>

</html>